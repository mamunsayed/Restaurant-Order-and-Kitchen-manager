<html>
<head>
    <title>Start Order</title>
    <style>
        *{
            box-sizing: border-box;
        }
        body{
            margin: 0;
            padding: 0;
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f4f5fb;
        }
        h1{
            width: 900px;
            margin: 20px auto 10px;
            font-size: 26px;
            color: #111827;
        }
        #box{
            width: 900px;
            background-color: #ffffff;
            padding: 20px 30px;
            margin: 10px auto 30px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(15,23,42,0.08);
        }
        fieldset{
            border: none;
            padding: 10px 0;
            margin: 0;
        }
        legend{
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        select{
            width: 300px;
            height: 34px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 14px;
            background-color: #ffffff;
        }
        input[type="text"]{
            width: 300px;
            height: 30px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 4px 8px;
            background-color: #f9fafb;
            font-size: 14px;
        }
        input[type="submit"]{
            padding: 8px 18px;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 6px;
        }
        input[type="submit"]:hover{
            background-color: #1d4ed8;
        }
        table{
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
        }
        th, td{
            padding: 8px 10px;
            text-align: left;
            font-size: 14px;
        }
        p{
            margin: 4px 0 0 0;
            font-size: 12px;
            color: #ef4444;
        }
    </style>
</head>
<body>
    <h1>Orders</h1>

    <div id="box">
        <form action="" method="" enctype="" id="orderForm" onsubmit="return test()">
            <fieldset>
                <legend>Start Order (Assign Table)</legend>
                <table>
                    <tr>
                        <td>Select Table</td>
                        <td>
                            <select id="tableSelect" name="tableSelect" onchange="updateTableStatus();testTableSelect()">
                                <option value="">-- Select Table --</option>
                            </select>
                        </td>
                        <td>Current Table Status</td>
                        <td>
                            <input type="text" id="tableStatus" name="tableStatus" value="Select a table" readonly>
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><p id="tError"></p></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <input type="submit" name="" value="Start Order">
                        </td>
                        <td></td>
                        <td></td>
                    </tr>
                </table>
            </fieldset>
        </form>
    </div>

    
    <script>
        let tError = document.getElementById('tError');
        let statusInput = document.getElementById('tableStatus');

        function getOrders(){
            let data = localStorage.getItem('orders');
            if(data == null || data == ""){
                return [];
            }else{
                return JSON.parse(data);
            }
        }

        function saveOrders(orders){
            localStorage.setItem('orders', JSON.stringify(orders));
        }

        function loadTables(){
            let select = document.getElementById('tableSelect');
            let tables = ['T1','T2','T3','T4','T5','T6','T7','T8','T9','T10'];
            for(let i=0; i<tables.length; i++){
                let option = document.createElement('option');
                option.value = tables[i];
                option.text = tables[i];
                select.appendChild(option);
            }
        }

        function findOpenOrderByTable(tableName){
            let orders = getOrders();
            for(let i=0; i<orders.length; i++){
                if(orders[i].table == tableName && orders[i].status == "Open"){
                    return orders[i];
                }
            }
            return null;
        }

        function updateTableStatus(){
            let tableName = document.getElementById('tableSelect').value;
            if(tableName == ""){
                statusInput.value = "Select a table";
            }else{
                let openOrder = findOpenOrderByTable(tableName);
                if(openOrder == null){
                    statusInput.value = "Available";
                }else{
                    statusInput.value = "Occupied (Order #" + openOrder.id + ")";
                }
            }
        }

        function testTableSelect(){
            let tableName = document.getElementById('tableSelect').value;
            if(tableName == ""){
                tError.innerHTML = "please select a table!";
                tError.style.color = 'red';
            }else{
                let openOrder = findOpenOrderByTable(tableName);
                if(openOrder != null){
                    tError.innerHTML = "this table already has an open order!";
                    tError.style.color = 'red';
                }else{
                    tError.innerHTML = "";
                }
            }
        }

        function createOrder(){
            let tableName = document.getElementById('tableSelect').value;
            let orders = getOrders();
            let maxId = 100;
            for(let i=0; i<orders.length; i++){
                if(orders[i].id > maxId){
                    maxId = orders[i].id;
                }
            }
            let newId = maxId + 1;
            let order = {
                id: newId,
                table: tableName,
                status: "Open",
                items: []
            };
            orders.push(order);
            saveOrders(orders);
            localStorage.setItem('currentOrderId', newId);
            window.location.href = "order_details.html?id=" + newId;
        }

        function test(){
            testTableSelect();
            if(tError.innerHTML !== ""){
                return false;
            }else{
                createOrder();
                return false;
            }
        }

        loadTables();
        updateTableStatus();
    </script>
</body>
</html>