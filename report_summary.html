<html>
<head>
    <title>Sales Report Summary</title>
    <style>
        *{
            box-sizing: border-box;
        }
        body{
            margin: 0;
            padding: 0;
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f4f5fb;
        }
        h1{
            width: 900px;
            margin: 20px auto 10px;
            font-size: 26px;
            color: #111827;
        }
        #box{
            width: 1000px;
            background-color: #ffffff;
            padding: 20px 30px;
            margin: 10px auto 30px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(15,23,42,0.08);
        }
        fieldset{
            border: none;
            padding: 10px 0;
            margin: 0;
        }
        legend{
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        table{
            width: 100%;
            border-collapse: collapse;
            background-color: #ffffff;
            margin-top: 10px;
        }
        th{
            background-color: #f3f4f6;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 1px solid #e5e7eb;
        }
        th, td{
            border: 1px solid #e5e7eb;
            padding: 10px 12px;
            text-align: left;
            vertical-align: top;
        }
        .summaryTitle{
            font-size: 18px;
            font-weight: bold;
        }
        input[type="button"]{
            padding: 8px 18px;
            border-radius: 6px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 8px;
            margin-top: 8px;
        }
        #printButton{
            background-color: #2563eb;
            color: #ffffff;
        }
        #backButton{
            background-color: #e5e7eb;
            color: #111827;
        }
        input[type="button"]:hover{
            filter: brightness(0.95);
        }
    </style>
</head>
<body>
    <h1>Sales Report Summary</h1>

    <div id="box">
        <fieldset>
            <legend>Summary</legend>
            <table>
                <tr>
                    <td colspan="4">From <span id="fromText"></span> to <span id="toText"></span></td>
                </tr>
                <tr>
                    <td class="summaryTitle">Total Orders</td>
                    <td class="summaryTitle">Total Sales</td>
                    <td class="summaryTitle">Total Discount</td>
                    <td class="summaryTitle">Total Tax</td>
                </tr>
                <tr>
                    <td><span id="totalOrders">0</span><br>Completed in the selected range</td>
                    <td>$<span id="totalSales">0.00</span><br>Includes tax and service charges</td>
                    <td>$<span id="totalDiscount">0.00</span><br>All promotional discounts</td>
                    <td>$<span id="totalTax">0.00</span><br>VAT / GST collected</td>
                </tr>
                <tr>
                    <td class="summaryTitle">Total Service Charge</td>
                    <td colspan="3" rowspan="2">
                        <b>Payments by Method</b><br>
                        Cash: $<span id="cashTotal">0.00</span><br>
                        Card: $<span id="cardTotal">0.00</span><br>
                        Digital: $<span id="digitalTotal">0.00</span>
                    </td>
                </tr>
                <tr>
                    <td>$<span id="totalService">0.00</span><br>Service fees in this period</td>
                </tr>
                <tr>
                    <td colspan="4">
                        <input type="button" id="backButton" name="" value="Back to Filter" onclick="goBack()">
                        <input type="button" id="printButton" name="" value="Print Report" onclick="printReport()">
                    </td>
                </tr>
            </table>
        </fieldset>
    </div>

    <script>
        let fromText = document.getElementById('fromText');
        let toText = document.getElementById('toText');

        let totalOrdersSpan = document.getElementById('totalOrders');
        let totalSalesSpan = document.getElementById('totalSales');
        let totalDiscountSpan = document.getElementById('totalDiscount');
        let totalTaxSpan = document.getElementById('totalTax');
        let totalServiceSpan = document.getElementById('totalService');

        let cashTotalSpan = document.getElementById('cashTotal');
        let cardTotalSpan = document.getElementById('cardTotal');
        let digitalTotalSpan = document.getElementById('digitalTotal');

        function getOrders(){
            let data = localStorage.getItem('orders');
            if(data == null || data == ""){
                return [];
            }else{
                return JSON.parse(data);
            }
        }

        function loadReportDates(){
            let from = localStorage.getItem('reportFromDate');
            let to = localStorage.getItem('reportToDate');
            let today = new Date();
            if(from == null || from == ""){
                let y = today.getFullYear();
                let m = today.getMonth()+1;
                let d = today.getDate();
                if(m<10){m="0"+m;}
                if(d<10){d="0"+d;}
                from = y+"-"+m+"-"+d;
            }
            if(to == null || to == ""){
                let y = today.getFullYear();
                let m = today.getMonth()+1;
                let d = today.getDate();
                if(m<10){m="0"+m;}
                if(d<10){d="0"+d;}
                to = y+"-"+m+"-"+d;
            }
            fromText.innerHTML = from;
            toText.innerHTML = to;
            return {from: from, to: to};
        }

        function isDateInRange(dateStr, from, to){
            if(dateStr == null || dateStr == ""){
                return false;
            }else{
                if(dateStr >= from && dateStr <= to){
                    return true;
                }else{
                    return false;
                }
            }
        }

        function generateSummary(){
            let range = loadReportDates();
            let from = range.from;
            let to = range.to;

            let totalOrders = 0;
            let totalSales = 0;
            let totalDiscount = 0;
            let totalTax = 0;
            let totalService = 0;

            let cashTotal = 0;
            let cardTotal = 0;
            let digitalTotal = 0;

            let orders = getOrders();
            for(let i=0; i<orders.length; i++){
                let o = orders[i];
                if(o.paymentStatus == "Paid"){
                    let date = "";
                    if(o.completedDate != null && o.completedDate !== ""){
                        date = o.completedDate;
                    }else if(o.date != null && o.date !== ""){
                        date = o.date;
                    }
                    if(isDateInRange(date, from, to)){
                        totalOrders = totalOrders + 1;

                        if(o.billing != null){
                            if(!isNaN(o.billing.totalPayable)){
                                totalSales = totalSales + parseFloat(o.billing.totalPayable);
                            }
                            if(!isNaN(o.billing.discountAmount)){
                                totalDiscount = totalDiscount + parseFloat(o.billing.discountAmount);
                            }
                            if(!isNaN(o.billing.taxAmount)){
                                totalTax = totalTax + parseFloat(o.billing.taxAmount);
                            }
                            if(!isNaN(o.billing.serviceAmount)){
                                totalService = totalService + parseFloat(o.billing.serviceAmount);
                            }
                        }

                        if(o.payment != null && o.payment.method != null){
                            let m = o.payment.method;
                            let amount = 0;
                            if(o.billing != null && !isNaN(o.billing.totalPayable)){
                                amount = parseFloat(o.billing.totalPayable);
                            }
                            if(m == "Cash"){
                                cashTotal = cashTotal + amount;
                            }else if(m == "Card"){
                                cardTotal = cardTotal + amount;
                            }else if(m == "Digital"){
                                digitalTotal = digitalTotal + amount;
                            }
                        }
                    }
                }
            }

            totalOrdersSpan.innerHTML = totalOrders;
            totalSalesSpan.innerHTML = totalSales.toFixed(2);
            totalDiscountSpan.innerHTML = totalDiscount.toFixed(2);
            totalTaxSpan.innerHTML = totalTax.toFixed(2);
            totalServiceSpan.innerHTML = totalService.toFixed(2);

            cashTotalSpan.innerHTML = cashTotal.toFixed(2);
            cardTotalSpan.innerHTML = cardTotal.toFixed(2);
            digitalTotalSpan.innerHTML = digitalTotal.toFixed(2);
        }

        function printReport(){
            window.print();
        }

        function goBack(){
            window.location.href = "report_filter.html";
        }

        generateSummary();
    </script>
</body>
</html>